BROKER SCHEMA co.com.ach.payment.executePayment


CREATE COMPUTE MODULE ExecuteBankPayment_6_ValidateResponseStartPay
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN
		-- declarar referencias a mensajes de entrada
		DECLARE refGroups REFERENCE TO InputRoot.ComIbmGroupCompleteNode;
		MOVE refGroups LASTCHILD;
		MOVE refGroups LASTCHILD;
		
		-- referencias a mensaje original y respuesta
		DECLARE refOriginal REFERENCE TO refGroups.OrigenRq;
		DECLARE refInitBankPayment REFERENCE TO refGroups.InitBankPaymentRs;
		
		
		-- declarar referencia de salida
		CREATE FIELD OutputRoot.JSON.Data;
		DECLARE refOut REFERENCE TO OutputRoot.JSON.Data;
		
		-- validar si es exitoso, contin√∫a proceso
		-- mensaje de respuesta
		MOVE refOriginal LASTCHILD;
		MOVE refOriginal LASTCHILD;
		MOVE refOriginal LASTCHILD;
		MOVE refOriginal LASTCHILD;
		
		MOVE refInitBankPayment LASTCHILD;
		MOVE refInitBankPayment LASTCHILD;
		MOVE refInitBankPayment LASTCHILD;
		MOVE refInitBankPayment LASTCHILD;
		
		SET OutputLocalEnvironment.Destination.CallableFlow.Reply.ReplyIdentifier = CAST(refOriginal.session.Destination.CallableFlow.Reply.ReplyIdentifier AS BLOB);
		
		-- construir mensaje ISO 20022 de error.
		SET refOut.group_header 							= refOriginal.group_header;
		SET refOut.original_payment_information_and_status 	= refInitBankPayment.original_payment_information_and_status;			
		
				
		RETURN TRUE;
	END;
END MODULE;
