BROKER SCHEMA co.com.ach.payment.transversals


CREATE COMPUTE MODULE TransversalesGetToken_Prepare_request
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN
		DECLARE refInp REFERENCE TO InputRoot.JSON;
		MOVE refInp LASTCHILD;
		
		-- nombre de componente
		SET Environment.flujo = 'TransversalesGetToken';
		SET Environment.urs.MQRFH2 = InputRoot.MQRFH2;
		
		-- copiar parámetros
		SET OutputLocalEnvironment.Destination.HTTP.Request.Parameters=  InputLocalEnvironment.REST.Input.Parameters;
		
		
		-- Enviar datos de autenticación
		SET OutputRoot.HTTPRequestHeader."Authorization" 	= 'Basic '||BASE64ENCODE(CAST(refInp.username||':'||refInp.password as BLOB CCSID 1208));
		SET OutputRoot.HTTPRequestHeader."Content-type"		= 'application/x-www-form-urlencoded';
		
		SET OutputLocalEnvironment.Destination.HTTP.QueryString.grant_type 		= refInp.grant_type;
		SET OutputLocalEnvironment.Destination.HTTP.QueryString.client_id 		= refInp.client_id;
		SET OutputLocalEnvironment.Destination.HTTP.QueryString.client_secret 	= refInp.client_secret;
		SET OutputLocalEnvironment.Destination.HTTP.QueryString.scope 			= refInp.scope;
		
		
		--Configuraciones
		SET OutputLocalEnvironment.Destination.REST.Request.Accept 	= 'application/json';
		SET OutputLocalEnvironment.Destination.HTTP.RequestURL 		= backUrl;
		SET OutputLocalEnvironment.Destination.HTTP.TimeoutMillis 	= backTimeout;
		
		-- copiar cuerpo del mensaje
		SET OutputRoot.JSON.Data = InputRoot.JSON.Data;		
		RETURN TRUE;
	END;
END MODULE;
